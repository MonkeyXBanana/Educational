<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Wonders - Preschool Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Comic Sans MS', cursive, sans-serif; background: linear-gradient(135deg, #74b9ff, #0984e3); min-height: 100vh; overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: white; font-size: 3em; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }

        .weather-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 20px; }
        .weather-card { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; position: relative; overflow: hidden; }
        .weather-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .weather-icon { font-size: 4em; margin-bottom: 20px; display: block; animation: bounce 2s infinite; }
        .weather-card h2 { color: #2d3436; margin-bottom: 15px; font-size: 1.8em; }
        .weather-card p { color: #2d3436; line-height: 1.5; font-size: 1.15em; }

        /* Weather-specific styles */
        .sunny { background: linear-gradient(135deg, #fdcb6e, #e17055); }
        .rainy { background: linear-gradient(135deg, #74b9ff, #0984e3); }
        .snowy { background: linear-gradient(135deg, #ddd, #74b9ff); }
        .stormy { background: linear-gradient(135deg, #636e72, #2d3436); }
        .stormy h2 { color: #f1f1f1; }
        .stormy p { color: #eaeaea; }
        .cloudy { background: linear-gradient(135deg, #bdc3c7, #95a5a6); }

        /* Animations */
        @keyframes bounce { 0%,20%,50%,80%,100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        @keyframes pulse { 0%,100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 0.85; } }
        @keyframes rain { 0% { transform: translateY(-100px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(100px); opacity: 0; } }
        @keyframes snow { 0% { transform: translateY(-100px) rotate(0deg); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(100px) rotate(360deg); opacity: 0; } }
        @keyframes lightning { 0%,90%,100% { opacity: 0; } 5%,85% { opacity: 1; } }
        @keyframes sway { 0%,100% { transform: translateX(0); } 50% { transform: translateX(10px); } }
        @keyframes cloudMove { 0% { left: -100px; } 100% { left: 110%; } }
        @keyframes windFlow { 0% { left: -80px; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { left: 110%; opacity: 0; } }

        /* Weather effects */
        .rain-effect { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .raindrop { position: absolute; width: 3px; height: 20px; background: rgba(74,144,226,0.7); border-radius: 2px; animation: rain 1s linear infinite; }
        .snowflake { position: absolute; color: white; font-size: 1.5em; animation: snow 3s linear infinite; }
        .lightning-flash { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); animation: lightning 2s infinite; pointer-events: none; }
        .sun-glow { position: absolute; top: 15px; right: 15px; font-size: 2em; animation: pulse 2s infinite; }
        .storm-cloud { position: absolute; top: 10px; left: -60px; width: 80px; height: 40px; background: #555; border-radius: 40px; animation: cloudMove 6s linear infinite; }
        .storm-cloud:after { content: ""; position: absolute; width: 50px; height: 50px; background: #555; border-radius: 50%; top: -20px; left: 10px; }
        .wind-line { position: absolute; width: 60px; height: 6px; background: rgba(255,255,255,0.6); border-radius: 3px; animation: windFlow 3s linear infinite; }

        .sound-btn { background: rgba(255, 255, 255, 0.2); border: 2px solid white; color: white; padding: 10px 20px; border-radius: 25px; cursor: pointer; margin-top: 15px; transition: all 0.3s ease; font-size: 1.1em; }
        .sound-btn:hover { background: white; color: #333; }
        .no-sound { background: rgba(128, 128, 128, 0.3); border: 2px solid #999; color: #999; cursor: not-allowed; }
        .no-sound:hover { background: rgba(128, 128, 128, 0.3); color: #999; }

        .intro { background: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 30px; margin-bottom: 30px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .intro h2 { color: #2d3436; margin-bottom: 15px; font-size: 2em; }
        .intro p { color: #2d3436; font-size: 1.2em; line-height: 1.6; }

        /* Worksheet 1 (Matching) */
        .worksheet { margin-top: 40px; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .worksheet h3 { font-size: 2.2em; color: #2d3436; text-align: center; margin-bottom: 10px; }
        .worksheet-sub { text-align: center; color: #2d3436; margin-bottom: 24px; font-size: 1.2em; }
        .worksheet-grid { display: grid; grid-template-columns: 1fr 320px; gap: 24px; }
        @media (max-width: 900px) { .worksheet-grid { grid-template-columns: 1fr; } }
        .pictures { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 16px; }
        .pic-card { position: relative; background: #f7f9fc; border: 3px dashed #b2bec3; border-radius: 16px; height: 160px; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: border-color 0.2s ease, transform 0.2s ease; }
        .pic-card .icon { font-size: 48px; margin-bottom: 8px; }
        .pic-card .label { font-size: 16px; color: #8395a7; font-weight: bold; }
        .pic-card[data-dropover="true"] { border-color: #00b894; transform: scale(1.02); }
        .pic-card.matched { border: 3px solid #00b894; background: #eafff4; }
        .names { display: flex; flex-wrap: wrap; gap: 12px; align-content: flex-start; }
        .name-chip { user-select: none; background: #dfe6e9; border: 3px solid #b2bec3; color: #2d3436; padding: 12px 16px; border-radius: 999px; cursor: grab; font-weight: bold; font-size: 1.1em; transition: transform 0.15s ease, box-shadow 0.15s ease; }
        .name-chip:active { cursor: grabbing; transform: scale(0.98); }
        .name-chip.disabled { opacity: 0.5; cursor: not-allowed; }
        .overlay-mark { position: absolute; top: 8px; right: 8px; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transform: scale(0.6); opacity: 0; animation: popIn 250ms ease-out forwards; font-size: 1.2em; }
        .overlay-mark.success { background: #2ecc71; }
        .overlay-mark.error { background: #e74c3c; }
        @keyframes popIn { to { transform: scale(1); opacity: 1; } }
        .completion { margin-top: 16px; text-align: center; font-size: 1.3em; color: #2d3436; display: none; font-weight: bold; }
        .completion.show { display: block; }

        /* Worksheet 2 (Quiz) */
        .quiz { margin-top: 30px; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .quiz h3 { font-size: 2em; text-align: center; color: #2d3436; margin-bottom: 10px; }
        .quiz-sub { text-align: center; color: #2d3436; margin-bottom: 18px; font-size: 1.15em; }
        .quiz .question { text-align: center; margin: 18px 0; }
        .quiz .icon { font-size: 4em; margin-bottom: 12px; }
        .quiz .options { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
        .quiz button { padding: 12px 20px; font-size: 1.1em; border-radius: 12px; border: 3px solid #ccc; cursor: pointer; transition: all .2s; background: #f7f9fc; color: #2d3436; }
        .quiz button.correct { background: #2ecc71; color: white; border-color: #27ae60; }
        .quiz button.incorrect { background: #e74c3c; color: white; border-color: #c0392b; }
        .quiz .feedback { min-height: 38px; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 8px; }
        .quiz .symbol { font-size: 1.6em; }
        .quiz .praise { font-size: 1.2em; font-weight: bold; color: #2d3436; opacity: 0; transform: scale(0.8); }
        .quiz .praise.show { animation: praisePop 350ms ease-out forwards; }
        @keyframes praisePop { to { opacity: 1; transform: scale(1); } }
        .quiz .completion { text-align: center; font-size: 1.5em; margin-top: 16px; display: none; }

        /* Video section */
        .video-section { margin: 40px auto 20px; background: rgba(255,255,255,0.95); border-radius: 20px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); max-width: 960px; }
        .video-section h3 { text-align: center; color: #2d3436; font-size: 2em; margin-bottom: 12px; }
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 16px; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå§Ô∏è Weather Fun!</h1>

        <div class="intro">
            <h2>Hello Kids! üëã</h2>
            <p>Let's learn about weather! Click each picture to see and hear what it's like outside!</p>
        </div>

        <div class="weather-grid">
            <!-- Sunny -->
            <div class="weather-card sunny" onclick="playSound('sunny')">
                <span class="weather-icon">‚òÄÔ∏è</span>
                <span class="sun-glow">‚òÄÔ∏è</span>
                <h2>Sunny</h2>
                <p>The sun is shining bright! The sky is blue and it feels warm. Perfect for playing outside! üåû</p>
                <button class="sound-btn">üîä Hear Happy Sounds</button>
            </div>
            <!-- Rainy -->
            <div class="weather-card rainy" onclick="playSound('rain')">
                <div class="rain-effect" id="rainEffect"></div>
                <span class="weather-icon">üåßÔ∏è</span>
                <h2>Rainy</h2>
                <p>Water drops fall from the clouds! You need an umbrella to stay dry. Plants love the rain! ‚òî</p>
                <button class="sound-btn">üîä Hear Rain Sounds</button>
            </div>
            <!-- Snowy -->
            <div class="weather-card snowy">
                <div class="rain-effect" id="snowEffect"></div>
                <span class="weather-icon">‚ùÑÔ∏è</span>
                <h2>Snowy</h2>
                <p>Soft white snow falls down! It covers everything like a fluffy blanket. You can build a snowman! ‚õÑ</p>
                <button class="sound-btn no-sound">üîá Quiet Snow</button>
            </div>
            <!-- Stormy -->
            <div class="weather-card stormy" onclick="playSound('storm')">
                <div class="lightning-flash" id="lightningFlash"></div>
                <div class="storm-cloud"></div>
                <span class="weather-icon">‚õàÔ∏è</span>
                <h2>Stormy</h2>
                <p>Dark clouds come! Lightning flashes bright and thunder goes BOOM! Stay inside where it's safe! ‚ö°</p>
                <button class="sound-btn">üîä Hear Thunder</button>
            </div>
            <!-- Cloudy (renamed from Windy) -->
            <div class="weather-card cloudy" onclick="playSound('cloudy')">
                <div class="wind-line" style="top: 30px; animation-delay: 0s;"></div>
                <div class="wind-line" style="top: 60px; animation-delay: 1s;"></div>
                <div class="wind-line" style="top: 90px; animation-delay: 2s;"></div>
                <span class="weather-icon" style="animation: sway 1s ease-in-out infinite;">‚òÅÔ∏è</span>
                <h2>Cloudy</h2>
                <p>The sky is full of clouds. It might feel cool and shady. ‚òÅÔ∏è</p>
                <button class="sound-btn">üîä Hear Cloudy</button>
            </div>
        </div>

        <!-- Worksheet 1: Matching Game -->
        <section class="worksheet" aria-label="Weather Matching Game">
            <h3>üéØ Match the Pictures!</h3>
            <p class="worksheet-sub">Drag each word to the right picture. You'll hear a happy sound when you get it right! üòä</p>
            <div class="worksheet-grid">
                <!-- Pictures / Dropzones -->
                <div class="pictures">
                    <div class="pic-card" data-weather="Sunny" tabindex="0">
                        <div class="icon" aria-hidden="true">‚òÄÔ∏è</div>
                        <div class="label">Put word here</div>
                    </div>
                    <div class="pic-card" data-weather="Rainy" tabindex="0">
                        <div class="icon" aria-hidden="true">üåßÔ∏è</div>
                        <div class="label">Put word here</div>
                    </div>
                    <div class="pic-card" data-weather="Snowy" tabindex="0">
                        <div class="icon" aria-hidden="true">‚ùÑÔ∏è</div>
                        <div class="label">Put word here</div>
                    </div>
                    <div class="pic-card" data-weather="Stormy" tabindex="0">
                        <div class="icon" aria-hidden="true">‚õàÔ∏è</div>
                        <div class="label">Put word here</div>
                    </div>
                    <div class="pic-card" data-weather="Cloudy" tabindex="0">
                        <div class="icon" aria-hidden="true">‚òÅÔ∏è</div>
                        <div class="label">Put word here</div>
                    </div>
                </div>
                <!-- Names / Draggables -->
                <div class="names" id="nameBank" aria-label="Weather Words">
                    <div class="name-chip" draggable="true" data-name="Sunny" aria-grabbed="false">Sunny</div>
                    <div class="name-chip" draggable="true" data-name="Rainy" aria-grabbed="false">Rainy</div>
                    <div class="name-chip" draggable="true" data-name="Snowy" aria-grabbed="false">Snowy</div>
                    <div class="name-chip" draggable="true" data-name="Stormy" aria-grabbed="false">Stormy</div>
                    <div class="name-chip" draggable="true" data-name="Cloudy" aria-grabbed="false">Cloudy</div>
                </div>
            </div>
            <div id="completionMsg" class="completion">Awesome job! You matched them all! üéâüåü</div>
        </section>

        <!-- Worksheet 2: Multiple-Choice Quiz -->
        <section class="quiz" id="quizSection" aria-label="Weather Quiz">
            <h3>‚ùì What's the Weather?</h3>
            <p class="quiz-sub">Look at the picture. Tap the right word!</p>
            <div id="quizContent">
                <div class="question">
                    <div class="icon" id="quizIcon">‚òÄÔ∏è</div>
                    <div class="options" id="quizOptions"></div>
                    <div id="quizFeedback" class="feedback" aria-live="polite">
                        <span class="symbol" id="quizSymbol"></span>
                        <span class="praise" id="quizPraise"></span>
                    </div>
                </div>
            </div>
            <div id="quizCompletion" class="completion">üåü Great job! You did it! üéâ</div>
        </section>

        <!-- Video: Super Simple - How's The Weather? -->
        <section class="video-section" aria-label="Sing Along: What's The Weather?">
            <h3>üéµ Sing Along: "How's The Weather?"</h3>
            <div class="video-wrapper">
                <iframe 
                    src="https://www.youtube.com/embed/rD6FRDd9Hew" 
                    title="How's The Weather? | Super Simple Songs"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                ></iframe>
            </div>
            <p style="text-align:center; margin-top:10px; color:#2d3436; font-size: 0.95em;">
                Video courtesy of Super Simple on YouTube. Learn more on their site: 
                <a href="https://supersimple.com/song/hows-the-weather/" target="_blank" rel="noopener">How's The Weather?</a>
            </p>
        </section>
    </div>

    <script>
        // Visual effects for weather cards
        function createRain() {
            const rainEffect = document.getElementById('rainEffect');
            for (let i = 0; i < 40; i++) {
                const raindrop = document.createElement('div');
                raindrop.className = 'raindrop';
                raindrop.style.left = Math.random() * 100 + '%';
                raindrop.style.animationDelay = Math.random() * 1 + 's';
                raindrop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
                rainEffect.appendChild(raindrop);
            }
        }
        function createSnow() {
            const snowEffect = document.getElementById('snowEffect');
            const snowflakes = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
            for (let i = 0; i < 25; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = snowflakes[Math.floor(Math.random() * snowflakes.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.animationDelay = Math.random() * 3 + 's';
                snowflake.style.animationDuration = (Math.random() * 2 + 2) + 's';
                snowEffect.appendChild(snowflake);
            }
        }

        // Shared Audio
        let audioContext;
        let isPlaying = false;
        function initAudio() { if (!audioContext) { audioContext = new (window.AudioContext || window.webkitAudioContext)(); } }

        function playSound(weatherType) {
            initAudio();
            if (isPlaying && (weatherType==='storm' || weatherType==='rain')) return; // avoid overlapping the loud ones
            isPlaying = true;
            switch(weatherType) {
                case 'sunny': playSunnySound(); resetPlayFlag(1500); break;
                case 'rain': playRainSoundLouder(); resetPlayFlag(4000); break;
                case 'storm': playThunderLouderRealistic(); resetPlayFlag(6000); break;
                case 'cloudy': playWindGustSound(); resetPlayFlag(4200); break; // reuse gentle breeze for cloudy
                case 'wind': playWindGustSound(); resetPlayFlag(4200); break; // backward compatibility
            }
        }
        function resetPlayFlag(ms){ setTimeout(()=>{ isPlaying = false; }, ms); }

        // Weather demo sounds
        function playSunnySound() {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    osc.connect(gain); gain.connect(audioContext.destination);
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(800 + Math.random() * 400, audioContext.currentTime);
                    gain.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    osc.start(); osc.stop(audioContext.currentTime + 0.5);
                }, i * 200);
            }
        }

        // Louder, fuller rain: rolling noise + bandpass + random "drips"
        function playRainSoundLouder() {
            const length = 3.8; // seconds
            const bufferSize = Math.floor(audioContext.sampleRate * length);
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            // Pink-ish noise for natural rain
            let b0=0,b1=0,b2=0,b3=0,b4=0,b5=0,b6=0;
            for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;
                b0 = 0.99886 * b0 + white * 0.0555179;
                b1 = 0.99332 * b1 + white * 0.0750759;
                b2 = 0.96900 * b2 + white * 0.1538520;
                b3 = 0.86650 * b3 + white * 0.3104856;
                b4 = 0.55000 * b4 + white * 0.5329522;
                b5 = -0.7616 * b5 - white * 0.0168980;
                const pink = (b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362) * 0.11;
                b6 = white * 0.115926;
                data[i] = pink;
            }
            const src = audioContext.createBufferSource();
            src.buffer = buffer;
            const bp = audioContext.createBiquadFilter(); // focus mid raindrop band
            bp.type = 'bandpass';
            bp.frequency.value = 1200; // Hz
            bp.Q.value = 0.7;
            const low = audioContext.createBiquadFilter(); // low rumble
            low.type = 'lowshelf';
            low.frequency.value = 200;
            low.gain.value = 4;
            const gain = audioContext.createGain();
            gain.gain.value = 0.55; // louder
            const comp = audioContext.createDynamicsCompressor();
            comp.threshold.value = -12; comp.ratio.value = 8; comp.attack.value = 0.01; comp.release.value = 0.15;
            src.connect(bp); bp.connect(low); low.connect(comp); comp.connect(gain); gain.connect(audioContext.destination);
            src.start(); src.stop(audioContext.currentTime + length);

            // Random discrete drips/taps on top
            const dripCount = 10;
            for (let d = 0; d < dripCount; d++) {
                const t0 = audioContext.currentTime + Math.random() * (length - 0.3);
                const osc = audioContext.createOscillator();
                const g = audioContext.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600 + Math.random()*900, t0);
                g.gain.setValueAtTime(0.0001, t0);
                g.gain.exponentialRampToValueAtTime(0.12, t0 + 0.02);
                g.gain.exponentialRampToValueAtTime(0.001, t0 + 0.18);
                osc.connect(g); g.connect(audioContext.destination);
                osc.start(t0); osc.stop(t0 + 0.2);
            }
        }

        // Louder, more realistic thunder (stormy)
        function playThunderLouderRealistic() {
            const total = 5.8; // seconds
            const bufSize = Math.floor(audioContext.sampleRate * total);
            const buf = audioContext.createBuffer(1, bufSize, audioContext.sampleRate);
            const ch = buf.getChannelData(0);
            for (let i = 0; i < bufSize; i++) {
                const t = i / audioContext.sampleRate;
                const rumble = (
                    Math.sin(2*Math.PI*32*t) * Math.exp(-t*0.35) * 0.8 +
                    Math.sin(2*Math.PI*45*t + 0.3) * Math.exp(-t*0.4) * 0.6 +
                    Math.sin(2*Math.PI*24*t + 1.0) * Math.exp(-t*0.28) * 0.7
                );
                const bodyNoise = (Math.random()*2-1) * 0.5 * Math.exp(-t*0.6);
                let crackle = 0;
                const strikeWindows = [ [0.05,0.15], [1.4,1.7], [3.2,3.35] ];
                for (const w of strikeWindows) {
                    if (t > w[0] && t < w[1]) {
                        const local = (t - w[0]) / (w[1]-w[0]);
                        crackle += (Math.random()*2-1) * (1 - local) * 1.2;
                    }
                }
                ch[i] = (rumble + bodyNoise + crackle) * 0.6;
            }
            const source = audioContext.createBufferSource();
            source.buffer = buf;
            const hp = audioContext.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.value = 18;
            const lp = audioContext.createBiquadFilter(); lp.type = 'lowpass'; lp.frequency.value = 3000;
            const lowshelf = audioContext.createBiquadFilter(); lowshelf.type = 'lowshelf'; lowshelf.frequency.value = 80; lowshelf.gain.value = 10;
            const waveshaper = audioContext.createWaveShaper();
            waveshaper.curve = makeSaturationCurve(400);
            const pan = audioContext.createStereoPanner ? audioContext.createStereoPanner() : null;
            if (pan) pan.pan.value = (Math.random()*2-1) * 0.2;
            const gain = audioContext.createGain(); gain.gain.value = 0.85;
            const comp = audioContext.createDynamicsCompressor();
            comp.threshold.value = -10; comp.knee.value = 8; comp.ratio.value = 12; comp.attack.value = 0.003; comp.release.value = 0.22;
            source.connect(hp); hp.connect(lp); lp.connect(lowshelf); lowshelf.connect(waveshaper);
            if (pan) { waveshaper.connect(pan); pan.connect(comp); } else { waveshaper.connect(comp); }
            comp.connect(gain); gain.connect(audioContext.destination);
            addSubBoom(0.08, 0.9);
            addSubBoom(1.55, 0.7);
            addSubBoom(3.28, 0.6);
            source.start(); source.stop(audioContext.currentTime + total);
            const flash = document.getElementById('lightningFlash');
            burstFlash(flash, 120);
            setTimeout(() => burstFlash(flash, 160), 1500);
            setTimeout(() => burstFlash(flash, 90), 3300);

            function addSubBoom(delaySec, level){
                const t0 = audioContext.currentTime + delaySec;
                const osc = audioContext.createOscillator();
                const g = audioContext.createGain();
                osc.type = 'sine'; osc.frequency.setValueAtTime(40, t0);
                g.gain.setValueAtTime(0.0001, t0);
                g.gain.exponentialRampToValueAtTime(0.9*level, t0 + 0.04);
                g.gain.exponentialRampToValueAtTime(0.002, t0 + 1.4);
                osc.connect(g); g.connect(audioContext.destination);
                osc.start(t0); osc.stop(t0 + 1.5);
            }
            function burstFlash(el, ms){
                if(!el) return;
                el.style.animation = 'none'; el.offsetHeight;
                el.style.animation = `lightning ${ms/1000}s`;
            }
            function makeSaturationCurve(amount) {
                const n_samples = 44100, curve = new Float32Array(n_samples);
                const deg = Math.PI / 180; let x;
                for (let i = 0; i < n_samples; ++i ) {
                    x = i * 2 / n_samples - 1;
                    curve[i] = (3 + amount) * x * 20 * deg / (Math.PI + amount * Math.abs(x));
                }
                return curve;
            }
        }

        // Reused for Cloudy (gentle breeze/air movement)
        function playWindGustSound() {
            const bufferSize = audioContext.sampleRate * 4;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                const t = i / audioContext.sampleRate; const noise = (Math.random() * 2 - 1);
                const gust = Math.sin(t * 0.5 * Math.PI) * Math.sin(t * 2 * Math.PI); const intensity = 0.3 + gust * 0.4; data[i] = noise * intensity * 0.2;
            }
            const source = audioContext.createBufferSource(); const hp = audioContext.createBiquadFilter(); const lp = audioContext.createBiquadFilter(); const gain = audioContext.createGain();
            source.buffer = buffer; hp.type = 'highpass'; hp.frequency.value = 200; lp.type = 'lowpass'; lp.frequency.value = 2000;
            source.connect(hp); hp.connect(lp); lp.connect(gain); gain.connect(audioContext.destination);
            gain.gain.setValueAtTime(0.1, audioContext.currentTime);
            gain.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 1);
            gain.gain.linearRampToValueAtTime(0.15, audioContext.currentTime + 2);
            gain.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 3);
            gain.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 4);
            source.start(); source.stop(audioContext.currentTime + 4);
        }

        // Worksheet 1: Drag & Drop logic
        const chips = document.querySelectorAll('.name-chip');
        chips.forEach(chip => {
            chip.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', chip.dataset.name);
                chip.setAttribute('aria-grabbed', 'true');
                setTimeout(() => chip.classList.add('dragging'));
            });
            chip.addEventListener('dragend', () => {
                chip.setAttribute('aria-grabbed', 'false');
                chip.classList.remove('dragging');
            });
        });

        const dropzones = document.querySelectorAll('.pic-card');
        let matchedCount = 0;
        dropzones.forEach(zone => {
            zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.dataset.dropover = 'true'; });
            zone.addEventListener('dragleave', () => { zone.dataset.dropover = 'false'; });
            zone.addEventListener('drop', (e) => {
                e.preventDefault(); zone.dataset.dropover = 'false';
                if (zone.classList.contains('matched')) return;
                const droppedName = e.dataTransfer.getData('text/plain');
                const correct = droppedName === zone.dataset.weather;
                if (correct) {
                    markMatched(zone, droppedName);
                    playHappyTick();
                    matchedCount++;
                    if (matchedCount === 5) {
                        document.getElementById('completionMsg').classList.add('show');
                        burstConfetti(zone);
                    }
                } else {
                    showOverlay(zone, false);
                    playSadBuzz();
                }
            });
        });

        function markMatched(zone, name) {
            zone.classList.add('matched');
            const label = zone.querySelector('.label');
            label.textContent = name;
            showOverlay(zone, true);
            const chip = document.querySelector(`.name-chip[data-name="${name}"]`);
            if (chip) { chip.classList.add('disabled'); chip.setAttribute('draggable', 'false'); }
        }

        function showOverlay(zone, success = true) {
            const mark = document.createElement('div');
            mark.className = `overlay-mark ${success ? 'success' : 'error'}`;
            mark.textContent = success ? '‚úì' : '‚úó';
            zone.appendChild(mark);
            if (!success) { setTimeout(() => { mark.remove(); }, 800); }
        }

        // Shared feedback sounds (used by both worksheets)
        function playHappyTick() {
            initAudio();
            const bufSize = audioContext.sampleRate * 0.08;
            const buffer = audioContext.createBuffer(1, bufSize, audioContext.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufSize; i++) { data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufSize * 0.6)); }
            const click = audioContext.createBufferSource();
            const hp = audioContext.createBiquadFilter(); hp.type = 'highpass'; hp.frequency.value = 1500;
            const gainClick = audioContext.createGain(); gainClick.gain.value = 0.3;
            click.buffer = buffer; click.connect(hp); hp.connect(gainClick); gainClick.connect(audioContext.destination);
            click.start();
            const freqs = [660, 880, 990];
            freqs.forEach((f, idx) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                osc.type = 'sine'; osc.frequency.value = f;
                osc.connect(gain); gain.connect(audioContext.destination);
                const t0 = audioContext.currentTime + idx * 0.12;
                gain.gain.setValueAtTime(0.001, t0);
                gain.gain.exponentialRampToValueAtTime(0.2, t0 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, t0 + 0.25);
                osc.start(t0); osc.stop(t0 + 0.28);
            });
        }
        function playSadBuzz() {
            initAudio();
            const tones = [440, 330];
            tones.forEach((f, idx) => {
                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();
                const detuneOsc = audioContext.createOscillator();
                detuneOsc.frequency.value = f * 1.02;
                osc.frequency.value = f; osc.type = 'sawtooth'; detuneOsc.type = 'sawtooth';
                const mix = audioContext.createGain();
                osc.connect(mix); detuneOsc.connect(mix); mix.connect(gain); gain.connect(audioContext.destination);
                const t0 = audioContext.currentTime + idx * 0.18;
                gain.gain.setValueAtTime(0.001, t0);
                gain.gain.exponentialRampToValueAtTime(0.15, t0 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, t0 + 0.35);
                osc.start(t0); detuneOsc.start(t0);
                osc.stop(t0 + 0.38); detuneOsc.stop(t0 + 0.38);
            });
        }
        function burstConfetti(target) {
            const container = target.closest('.worksheet') || target.closest('.quiz') || document.body;
            for (let i = 0; i < 24; i++) {
                const piece = document.createElement('div');
                piece.textContent = ['üéâ','‚ú®','‚≠ê','üåü'][Math.floor(Math.random()*4)];
                piece.style.position = 'absolute';
                const rect = container.getBoundingClientRect();
                piece.style.left = (rect.left + rect.width/2) + 'px';
                piece.style.top = (rect.top + window.scrollY + 20) + 'px';
                piece.style.fontSize = (14 + Math.random()*12) + 'px';
                piece.style.transition = 'transform 1.2s ease-out, opacity 1.2s ease-out';
                piece.style.zIndex = 9999;
                document.body.appendChild(piece);
                const dx = (Math.random()*2-1) * 220; const dy = 140 + Math.random()*140;
                setTimeout(() => { piece.style.transform = `translate(${dx}px, ${dy}px) rotate(${Math.random()*360}deg)`; piece.style.opacity = '0'; }, 10);
                setTimeout(() => piece.remove(), 1300);
            }
        }

        // Worksheet 2: Quiz Logic with randomized praise
        const quizData = [
            { icon: '‚òÄÔ∏è', answer: 'Sunny', options: ['Sunny', 'Rainy', 'Snowy'] },
            { icon: 'üåßÔ∏è', answer: 'Rainy', options: ['Cloudy', 'Rainy', 'Sunny'] },
            { icon: '‚ùÑÔ∏è', answer: 'Snowy', options: ['Stormy', 'Snowy', 'Cloudy'] },
            { icon: '‚õàÔ∏è', answer: 'Stormy', options: ['Snowy', 'Stormy', 'Sunny'] },
            { icon: '‚òÅÔ∏è', answer: 'Cloudy', options: ['Cloudy', 'Rainy', 'Sunny'] }
        ];
        let currentQ = 0;
        const praiseCorrect = ['Great job!', 'Awesome!', 'You did it!', 'Yay, that\'s right!', 'Super star!'];
        const praiseWrong = ['Oops, try again!', 'Not this one!', 'Almost!', 'Give it another go!'];

        function randFrom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

        function loadQuestion() {
            const q = quizData[currentQ];
            document.getElementById('quizIcon').textContent = q.icon;
            const optBox = document.getElementById('quizOptions');
            optBox.innerHTML = '';
            const shuffled = q.options.slice().sort(() => Math.random() - 0.5);
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(btn, opt, q.answer);
                optBox.appendChild(btn);
            });
            showFeedback('', '');
        }

        function showFeedback(symbol, text) {
            const sym = document.getElementById('quizSymbol');
            const pr = document.getElementById('quizPraise');
            sym.textContent = symbol;
            pr.textContent = text;
            pr.classList.remove('show');
            if (text) { requestAnimationFrame(() => pr.classList.add('show')); }
        }

        function disableAllOptions() { document.querySelectorAll('#quizOptions button').forEach(b => b.disabled = true); }

        function checkAnswer(btn, choice, correct) {
            if (btn.disabled) return;
            if (choice === correct) {
                btn.classList.add('correct');
                disableAllOptions();
                showFeedback('‚úÖ', randFrom(praiseCorrect));
                playHappyTick();
                setTimeout(nextQuestion, 900);
            } else {
                btn.classList.add('incorrect');
                showFeedback('‚ùå', randFrom(praiseWrong));
                playSadBuzz();
            }
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ < quizData.length) {
                loadQuestion();
            } else {
                document.getElementById('quizContent').style.display = 'none';
                const done = document.getElementById('quizCompletion');
                done.style.display = 'block';
                burstConfetti(done);
            }
        }

        // Initialize page
        createRain();
        createSnow();
        document.querySelectorAll('.weather-card').forEach(card => {
            card.addEventListener('mouseenter', function() { if (!this.classList.contains('snowy')) { this.style.transform = 'translateY(-10px) scale(1.02)'; } });
            card.addEventListener('mouseleave', function() { this.style.transform = 'translateY(0) scale(1)'; });
        });
        document.querySelector('.snowy').style.cursor = 'default';

        loadQuestion();
    </script>
</body>
</html>